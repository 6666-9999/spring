<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.cssl.dao.HouseMapper">
	<insert id="issue" parameterType="house">
		INSERT INTO
		house(hid,usid,SID,tid,price,title,Content,htime,area,phone)
		values
		(house_seq.nextval,#{usid},#{sid},#{tid},#{price},#{title},#{content},#{htime},#{area},#{phone})
	</insert>
	<sql id="mysql">
		<where>
			<if test="titles!=null and titles!=''">
				and title like concat('%',concat(#{titles},'%'))
			</if>
			<if test="minPrice!=null and maxPrice!=null and maxPrice!=0">
				and price between #{minPrice} and #{maxPrice}
			</if>
			<if test="minArea!=null and maxArea!=null and maxArea!=0">
				and area between #{minArea} and #{maxArea}
			</if>
			<if test="type!=null and type!=0">
				AND h.tid=#{type}
			</if>
			<if test="dis!=null and dis!=0">
				AND d.did=#{dis}
			</if>
			<if test="street!=null and street!=0">
				AND h.sid=#{street}
			</if>
			<if test="usid!=null and usid!=0">
				AND h.usid=#{usid}
			</if>
		</where>
	</sql>
	<resultMap type="house" id="myhous">
		<id column="hid" property="hid" />
		<association property="users" javaType="users">
			<id column="usid" property="usid" />
		</association>
		<association property="dis" javaType="District">
			<id column="did" property="did" />
		</association>
		<association property="st" javaType="Street">
			<id column="sid" property="sid" />
		</association>
		<association property="tp" javaType="Type">
			<id column="tid" property="tid" />
		</association>
	</resultMap>
	<select id="getAllByLike" parameterType="map" resultMap="myhous">
		SELECT
		* FROM house h
		INNER JOIN street s ON h.sid=s.sid
		INNER JOIN
		district d ON
		s.sdid=d.did
		INNER JOIN TYPE t ON t.tid=h.tid
		INNER JOIN
		USERS u ON
		u.usid=h.usid
		<include refid="mysql" />
	</select>

	<select id="getByOne" parameterType="int" resultMap="myhous">
		SELECT
		* FROM
		house h
		INNER JOIN street s ON h.sid=s.sid
		INNER JOIN district d ON
		s.sdid=d.did
		INNER JOIN TYPE t ON t.tid=h.tid
		INNER JOIN USERS u ON
		u.usid=h.usid
		and h.hid=#{hid}
	</select>

	<update id="update" parameterType="house">
		UPDATE house SET
		SID=#{sid},tid=#{tid},price=#{price},title=#{title},CONTENT=#{content},htime=#{htime},area=#{area},phone=#{phone}
		WHERE hid=#{hid}
	</update>
	
	<delete id="del" parameterType="int">
		delete from house where hid=#{hid}
	</delete>
</mapper>